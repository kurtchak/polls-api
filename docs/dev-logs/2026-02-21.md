# Dev Log — 2026-02-21

## Zmeny dnes

Hlavne zmeny: oprava Kosice votes pipeline + podpora starsich sezon + **sync konzola na frontend**.

### polls-api (3 commity)

#### `1cae7fd` Add real-time sync console with SSE event streaming
- Novy SSE endpoint `/sync/events` — streamuje `SyncEvent` (id, timestamp, level, town, season, phase, message)
- `/sync/last-run` — vrati `LastRunSummary` s events, pocty synced/failed/skipped, trvanie
- `/sync/status` — rozsireny o progress (processedMeetings / totalMeetings)

#### `1335e9a` Reset syncRetryCount and syncError in resetSyncComplete query
- Ked sa resetuju meetings na re-sync, vynuluje sa aj retry count a error message

#### `3520ca7` Fix Kosice votes pipeline and add older season support
- `Meeting.isComplete()` — meeting bez polls = nekompletny (predtym bol "complete")
- `syncRetryCount` — ochrana proti nekonecnemu re-loadu (max 2 pokusy)
- `KosiceWebImport.memberSlugToName` — populate z DB pri restarte servera
- `extPollRouteId` na Kosice polls — chybal, bez neho sa votes nevytvárali
- Legacy member scraper pre starsie Kosice sezony (2018-2022)
- Member sync pri season discovery — predtym sa nacitali meetings ale 0 members
- PDF attachments z Kosice meeting pages

### polls-fe (3 commity)

#### `520364f` Add sync console tab with live SSE event streaming
- DataSourcesView: novy tab "Konzola" s SSE eventami, progress bar, trigger sync

#### `582b11b` Add reusable SyncConsole to HomeView and SeasonsView
- SSE eventy presunte do Pinia sync store — pretrvavaju pri navigacii medzi views
- Novy komponent `SyncConsole.vue` — znovupouzitelny, foldable (collapsible)
- HomeView: konzola + sumar pod zoznamom miest
- SeasonsView: konzola filtrovana podla mesta (`townFilter` prop)
- Opraveny sumar:
  - Hourglass iba pre aktualne synchronizovane mesto/sezonu
  - Zelena ikona pre INFO-only eventy (predtym nekorektne hourglass "Prebieha...")
  - Detekcia "uz synchronizovane" — ak vsetky meetings maju `synced: 0 polls`
- Zoradenie: najnovsie dokoncene navrchu, aktualne prebiehajuce s pulzujucou ikonkou
- Pulse animacia na running riadku, svetlo-modre pozadie

#### `7d79057` Fix TypeScript strict null errors in SyncConsole
- Array indexing `evts[0].town` → `evts[0]!.town` pre production build

## Sync konzola — architektura

```
App.vue
  └── sync.init()          // startSSE() + loadLastRun() + startPolling(3s)

Pinia sync store
  ├── consoleEvents[]      // SSE eventy, persistuju pri navigacii
  ├── lastRun              // posledny beh z /sync/last-run
  ├── status               // SyncStatus z /sync/status (polling 3s)
  └── isRunning            // computed

SyncConsole.vue (props: townFilter?)
  ├── displayEvents        // filtered by townFilter
  ├── summaryLines         // grouped by town/season, sorted
  ├── Console (col-7)      // dark bg, monospace, color-coded levels
  └── Summary (col-5)      // ikony: check_circle/cancel/warning/sync(pulse)
```

## Stav scraperv

| Mesto | Members | Meetings | Polls | Poznamky |
|-------|---------|----------|-------|----------|
| Bratislava | 366 (6 sezon) | 27 (2022-2026) | existujuce (2014-2022) | Starsie sezony 0 meetings |
| Presov | 127 (3 sezony) | existujuce | existujuce | OK |
| Poprad | 19 (2022-2026) | existujuce | existujuce | 2014/2018: 0 members |
| Trnava | 57 | 75 | 84+ polls | Starsie bez hlasovani v HTML |
| Kosice | 41 (2022-2026) + ~41 (2018-2022 legacy) | 35 + 37 | **v procese** | votes pipeline opraveny, caka sa na deploy verify |
| Nitra | 31 | 0 | 0 | Meetings neimplementovane |
| B. Bystrica | 31 | 0 | 0 | Meetings neimplementovane |
| Trencin | 25 | 0 | 0 | Meetings neimplementovane |

## Pozorovania

- **Production build striktnejsi nez dev server** — `vue-tsc` vyzaduje non-null assertions pri array indexing, dev server to ignoruje. Railway build padal kym sa neopravilo.
- **SSE eventy v Pinia store** — povodne boli lokalne v kazdom view, co znamenalo stratu eventov pri navigacii. Presun do store riesil problem.
- **Summary bug "Prebieha..."** — bratislava 2010-2014 mala len INFO eventy (Found seasons, Loaded members), ziadny SUCCESS/ERROR → padalo do else vetvy s hourglass. Opravene: INFO-only = green check.
- **Summary bug Kosice** — pocas syncu uz mala SUCCESS eventy z hotovych meetings → ukazovala zelenu ikonu aj ked sync este bezal. Opravene: ak `currentTown === town && currentSeason === season` → vzdy hourglass s pulse.

## TODO na dalsiu iteraciu

1. **Verify na Railway** — ci sa sync konzola zobrazi v produkcii
2. **Kosice votes verify** — ci sa votes nacitali po deploy `3520ca7`
3. **Kosice 2018-2022 PDF fallback** — ci DMPdfImporter spracuje Kosice PDF format
4. **Trnava enrichment** — 26/57 members bez match
5. **Nitra meetings** — scraper pre zoznam zasadnuti
