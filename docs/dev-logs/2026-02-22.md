# Dev Log — 2026-02-22

## Zmeny dnes

Hlavna zmena: **Gradle multi-module split** — monolit rozdeleny na 4 submoduly + bugfix party-switchers NPE.

### polls-api (3 commity)

#### `755d2d0` Split monolith into Gradle multi-module: domain, sync, bff, app

Rozdelenie monolitickeho projektu na 4 Gradle submoduly:

- **polls-domain** (55 suborov) — entity, repositories, enums, serializers, DataImport interface
- **polls-sync** (74 suborov) — scrapery, sync orchestracia, DM API, sync controllery
- **polls-bff** (22 suborov) — REST controllery a services pre frontend
- **polls-app** (2 subory + resources) — Application.java, DataSeeder.java, bootable JAR

Kroky:
1. Presun `Source`, `DataOperation` enumov do `domain.model.enums` package + update 30+ importov
2. Presun `DataImport` interface do `domain` package
3. Split `SeasonsController` — extract `AdminSeasonController` (discover endpoint → sync modul)
4. Nove `build.gradle.kts` pre kazdy modul, root je conventions-only parent
5. Fyzicky presun suborov do submodulových adresarov
6. Update Dockerfile pre multi-module build

Vysledok: BFF modul ma nulove importy z source/sync — hranica vynútená kompilátorom.

#### `3bbd5bf` Add -parameters compiler flag to all submodules

- Spring Boot plugin automaticky pridava `-parameters` pre javac
- Submoduly bez Boot pluginu (polls-bff, polls-sync) ho nemali
- `@PathVariable` bez explicitneho mena padal za behu: `IllegalArgumentException: Name for argument not specified`
- Fix: pridany `-parameters` do `subprojects {}` v root build.gradle.kts
- **Poucenie: vzdy overit na localhost pred commitom/pushom**

#### `cccd89b` Fix NPE in party-switchers when CouncilMember has no ClubMember

- `ActualCouncilMemberSerializer` volal `getClubMember().getClub().getName()` bez null checku
- Ak politik ma CouncilMember ale bez priradeného ClubMember → NPE → 500
- Fix: write `null` do JSON ked club data chybaju
- Overene: 94 party switchers, 45 club switchers sa vrátia korektne

## Architektura po splite

```
polls-domain  ←──  polls-sync   (scrapery, sync)
     ↑              ↑
     └──────  polls-bff    (REST API pre frontend)
                    ↑
              polls-app    (bootable JAR, spaja vsetko)
```

- polls-bff a polls-sync sa navzajom nevidia (ziadna zavislost)
- Obe zavisia len na polls-domain
- polls-app zavisi na vsetkych troch, obsahuje @SpringBootApplication

## Overenie po deployi

```bash
# Vsetky endpointy overene na localhost:
GET /{city}/{inst}/seasons          ✅
GET /{city}/{inst}/{season}/meetings ✅
GET /{city}/{inst}/{season}/members  ✅
GET /{city}/{season}/parties         ✅
GET /{city}/{season}/clubs           ✅
GET /{city}/{inst}/{season}/polls    ✅
GET /politicians/party-switchers     ✅ (bolo 500, opravene)
GET /politicians/club-switchers      ✅
```

## TODO na dalsiu iteraciu

1. **Verify na Railway** — ci multi-module Dockerfile funguje v produkcii
2. **Kosice votes verify** — ci sa votes nacitali po deploy `3520ca7`
3. **Nitra meetings** — scraper pre zoznam zasadnuti
4. **AI scraper modul** — teraz uz je cista hranica pre novy modul
